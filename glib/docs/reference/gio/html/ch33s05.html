<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>GIO Reference Manual: Generating code and docs</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="index.html" title="GIO Reference Manual">
<link rel="up" href="ch33.html" title="Migrating to GDBus">
<link rel="prev" href="ch33s04.html" title="Creating proxies for well-known names">
<link rel="next" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html" title="org.gtk.GDBus.Example.ObjectManager.Animal">
<meta name="generator" content="GTK-Doc V1.20.1 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="ch33.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="ch33s04.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id-1.5.5.6"></a>Generating code and docs</h2></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="gdbus-example-gdbus-codegen"></a>Using gdbus-codegen</h3></div></div></div>
<p>
      dbus-glib comes with <span class="command"><strong>dbus-binding-tool</strong></span>, which
      can produce somewhat nice client- and server-side wrappers for a D-Bus interface.
      With GDBus, <span class="command"><strong><a href="gdbus-codegen.html">gdbus-codegen</a></strong></span> is used and like
      its counterpart, it also takes D-Bus Introspection XML as input:
    </p>
<div class="example">
<a name="gdbus-example-codegen-input"></a><p class="title"><b>Example 2. Example D-Bus Introspection XML</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="gtkdoc opt">&lt;</span>node<span class="gtkdoc opt">&gt;</span>
  <span class="gtkdoc opt">&lt;!--</span> org<span class="gtkdoc opt">.</span>gtk<span class="gtkdoc opt">.</span>GDBus<span class="gtkdoc opt">.</span>Example<span class="gtkdoc opt">.</span>ObjectManager<span class="gtkdoc opt">.</span>Animal<span class="gtkdoc opt">:</span>
       &#64;short_description<span class="gtkdoc opt">:</span> Example docs generated by gdbus<span class="gtkdoc opt">-</span>codegen
       &#64;since<span class="gtkdoc opt">:</span> <span class="number">2.30</span>

       This D<span class="gtkdoc opt">-</span>Bus interface is used to describe a simple animal<span class="gtkdoc opt">.</span>
    <span class="gtkdoc opt">--&gt;</span>
  <span class="gtkdoc opt">&lt;</span>interface name<span class="gtkdoc opt">=</span><span class="string">&quot;org.gtk.GDBus.Example.ObjectManager.Animal&quot;</span><span class="gtkdoc opt">&gt;</span>
    <span class="gtkdoc opt">&lt;!--</span> Mood<span class="gtkdoc opt">:</span> The mood of the animal<span class="gtkdoc opt">.</span>
         &#64;since<span class="gtkdoc opt">:</span> <span class="number">2.30</span>

         Known values <span class="keyword">for this</span> property include
         <span class="gtkdoc opt">&lt;</span>literal<span class="gtkdoc opt">&gt;</span>Happy<span class="gtkdoc opt">&lt;/</span>literal<span class="gtkdoc opt">&gt;</span> <span class="keyword">and</span> <span class="gtkdoc opt">&lt;</span>literal<span class="gtkdoc opt">&gt;</span>Sad<span class="gtkdoc opt">&lt;/</span>literal<span class="gtkdoc opt">&gt;.</span> Use the
         org<span class="gtkdoc opt">.</span>gtk<span class="gtkdoc opt">.</span>GDBus<span class="gtkdoc opt">.</span>Example<span class="gtkdoc opt">.</span>ObjectManager<span class="gtkdoc opt">.</span>Animal<span class="gtkdoc opt">.</span><span class="function">Poke</span><span class="gtkdoc opt">()</span> method to
         change <span class="keyword">this</span> property<span class="gtkdoc opt">.</span>

         This property influences how often the animal jumps up <span class="keyword">and</span>
         down<span class="gtkdoc opt">,</span> see the
         <span class="gtkdoc ppc">#org.gtk.GDBus.Example.ObjectManager.Animal::Jumped signal</span>
         <span class="keyword">for</span> more details<span class="gtkdoc opt">.</span>
    <span class="gtkdoc opt">--&gt;</span>
    <span class="gtkdoc opt">&lt;</span>property name<span class="gtkdoc opt">=</span><span class="string">&quot;Mood&quot;</span> type<span class="gtkdoc opt">=</span><span class="string">&quot;s&quot;</span> access<span class="gtkdoc opt">=</span><span class="string">&quot;read&quot;</span><span class="gtkdoc opt">/&gt;</span>

    <span class="gtkdoc opt">&lt;!--</span>
        Poke<span class="gtkdoc opt">:</span>
        &#64;make_sad<span class="gtkdoc opt">:</span> Whether to make the animal sad<span class="gtkdoc opt">.</span>
        &#64;make_happy<span class="gtkdoc opt">:</span> Whether to make the animal happy<span class="gtkdoc opt">.</span>
        &#64;since<span class="gtkdoc opt">:</span> <span class="number">2.30</span>

        Method used to changing the mood of the animal<span class="gtkdoc opt">.</span> See also the
        <span class="gtkdoc ppc">#org.gtk.GDBus.Example.ObjectManager.Animal:Mood property.</span>
      <span class="gtkdoc opt">--&gt;</span>
    <span class="gtkdoc opt">&lt;</span>method name<span class="gtkdoc opt">=</span><span class="string">&quot;Poke&quot;</span><span class="gtkdoc opt">&gt;</span>
      <span class="gtkdoc opt">&lt;</span>arg direction<span class="gtkdoc opt">=</span><span class="string">&quot;in&quot;</span> type<span class="gtkdoc opt">=</span><span class="string">&quot;b&quot;</span> name<span class="gtkdoc opt">=</span><span class="string">&quot;make_sad&quot;</span><span class="gtkdoc opt">/&gt;</span>
      <span class="gtkdoc opt">&lt;</span>arg direction<span class="gtkdoc opt">=</span><span class="string">&quot;in&quot;</span> type<span class="gtkdoc opt">=</span><span class="string">&quot;b&quot;</span> name<span class="gtkdoc opt">=</span><span class="string">&quot;make_happy&quot;</span><span class="gtkdoc opt">/&gt;</span>
    <span class="gtkdoc opt">&lt;/</span>method<span class="gtkdoc opt">&gt;</span>

    <span class="gtkdoc opt">&lt;!--</span>
        Jumped<span class="gtkdoc opt">:</span>
        &#64;height<span class="gtkdoc opt">:</span> Height<span class="gtkdoc opt">,</span> in meters<span class="gtkdoc opt">,</span> that the animal jumped<span class="gtkdoc opt">.</span>
        &#64;since<span class="gtkdoc opt">:</span> <span class="number">2.30</span>

        Emitted when the animal decides to jump<span class="gtkdoc opt">.</span>
      <span class="gtkdoc opt">--&gt;</span>
    <span class="gtkdoc opt">&lt;</span>signal name<span class="gtkdoc opt">=</span><span class="string">&quot;Jumped&quot;</span><span class="gtkdoc opt">&gt;</span>
      <span class="gtkdoc opt">&lt;</span>arg type<span class="gtkdoc opt">=</span><span class="string">&quot;d&quot;</span> name<span class="gtkdoc opt">=</span><span class="string">&quot;height&quot;</span><span class="gtkdoc opt">/&gt;</span>
    <span class="gtkdoc opt">&lt;/</span>signal<span class="gtkdoc opt">&gt;</span>

    <span class="gtkdoc opt">&lt;!--</span>
        Foo<span class="gtkdoc opt">:</span>
        Property with no <span class="gtkdoc opt">&lt;</span>quote<span class="gtkdoc opt">&gt;</span>since<span class="gtkdoc opt">&lt;/</span>quote<span class="gtkdoc opt">&gt;</span> <span class="function">annotation</span> <span class="gtkdoc opt">(</span>should inherit the <span class="number">2.30</span> from its containing interface<span class="gtkdoc opt">).</span>
      <span class="gtkdoc opt">--&gt;</span>
    <span class="gtkdoc opt">&lt;</span>property name<span class="gtkdoc opt">=</span><span class="string">&quot;Foo&quot;</span> type<span class="gtkdoc opt">=</span><span class="string">&quot;s&quot;</span> access<span class="gtkdoc opt">=</span><span class="string">&quot;read&quot;</span><span class="gtkdoc opt">/&gt;</span>

    <span class="gtkdoc opt">&lt;!--</span>
        Bar<span class="gtkdoc opt">:</span>
        &#64;since<span class="gtkdoc opt">:</span> <span class="number">2.36</span>
        Property with a later <span class="gtkdoc opt">&lt;</span>quote<span class="gtkdoc opt">&gt;</span>since<span class="gtkdoc opt">&lt;/</span>quote<span class="gtkdoc opt">&gt;</span> annotation<span class="gtkdoc opt">.</span>
      <span class="gtkdoc opt">--&gt;</span>
    <span class="gtkdoc opt">&lt;</span>property name<span class="gtkdoc opt">=</span><span class="string">&quot;Bar&quot;</span> type<span class="gtkdoc opt">=</span><span class="string">&quot;s&quot;</span> access<span class="gtkdoc opt">=</span><span class="string">&quot;read&quot;</span><span class="gtkdoc opt">/&gt;</span>
  <span class="gtkdoc opt">&lt;/</span>interface<span class="gtkdoc opt">&gt;</span>

  <span class="gtkdoc opt">&lt;!--</span> org<span class="gtkdoc opt">.</span>gtk<span class="gtkdoc opt">.</span>GDBus<span class="gtkdoc opt">.</span>Example<span class="gtkdoc opt">.</span>ObjectManager<span class="gtkdoc opt">.</span>Cat<span class="gtkdoc opt">:</span>
       &#64;short_description<span class="gtkdoc opt">:</span> More example docs generated by gdbus<span class="gtkdoc opt">-</span>codegen

       This D<span class="gtkdoc opt">-</span>Bus interface is used to describe a cat<span class="gtkdoc opt">.</span> Right now there
       are no properties<span class="gtkdoc opt">,</span> methods <span class="keyword">or</span> signals associated with <span class="keyword">this</span>
       interface so it is essentially a <span class="gtkdoc opt">&lt;</span>ulink
       url<span class="gtkdoc opt">=</span><span class="string">&quot;http://en.wikipedia.org/wiki/Marker_interface_pattern&quot;</span><span class="gtkdoc opt">&gt;</span>Marker
       Interface<span class="gtkdoc opt">&lt;/</span>ulink<span class="gtkdoc opt">&gt;.</span>

       Note that D<span class="gtkdoc opt">-</span>Bus objects implementing <span class="keyword">this</span> interface also
       implement the <span class="gtkdoc ppc">#org.gtk.GDBus.Example.ObjectManager.Animal</span>
       interface<span class="gtkdoc opt">.</span>
    <span class="gtkdoc opt">--&gt;</span>
  <span class="gtkdoc opt">&lt;</span>interface name<span class="gtkdoc opt">=</span><span class="string">&quot;org.gtk.GDBus.Example.ObjectManager.Cat&quot;</span><span class="gtkdoc opt">&gt;</span>
  <span class="gtkdoc opt">&lt;/</span>interface<span class="gtkdoc opt">&gt;</span>
<span class="gtkdoc opt">&lt;/</span>node<span class="gtkdoc opt">&gt;</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break"><p>
      If this XML is processed like this
</p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6</pre></td>
        <td class="listing_code"><pre class="programlisting">gdbus<span class="gtkdoc opt">-</span>codegen <span class="gtkdoc opt">--</span>interface<span class="gtkdoc opt">-</span>prefix org<span class="gtkdoc opt">.</span>gtk<span class="gtkdoc opt">.</span>GDBus<span class="gtkdoc opt">.</span>Example<span class="gtkdoc opt">.</span>ObjectManager<span class="gtkdoc opt">.</span> \
              <span class="gtkdoc opt">--</span>generate<span class="gtkdoc opt">-</span>c<span class="gtkdoc opt">-</span>code generated<span class="gtkdoc opt">-</span>code	                      \
              <span class="gtkdoc opt">--</span>c<span class="gtkdoc opt">-</span><span class="keyword">namespace</span> Example 				      \
              <span class="gtkdoc opt">--</span>c<span class="gtkdoc opt">-</span>generate<span class="gtkdoc opt">-</span>object<span class="gtkdoc opt">-</span>manager			      \
              <span class="gtkdoc opt">--</span>generate<span class="gtkdoc opt">-</span>docbook generated<span class="gtkdoc opt">-</span>docs                       \
              gdbus<span class="gtkdoc opt">-</span>example<span class="gtkdoc opt">-</span>objectmanager<span class="gtkdoc opt">.</span>xml</pre></td>
      </tr>
    </tbody>
  </table>
</div>

<p>
      then two files <code class="filename">generated-code.h</code> and
      <code class="filename">generated-code.c</code> are
      generated. Additionally, two XML files
      <code class="filename">generated-docs-org.gtk.GDBus.Example.ObjectManager.Animal</code> and
      <code class="filename">generated-docs-org.gtk.GDBus.Example.ObjectManager.Cat</code>
      with Docbook XML are generated. For an example of what the docs look
      like see <a class="link" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html#gdbus-interface-org-gtk-GDBus-Example-ObjectManager-Animal" title="Description">the Animal D-Bus interface documentation</a>.
      and
      <a class="link" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Cat.html#gdbus-interface-org-gtk-GDBus-Example-ObjectManager-Cat" title="Description">the Cat D-Bus interface documentation</a>.
    </p>
<p>
      While the contents of <code class="filename">generated-code.h</code> and
      <code class="filename">generated-code.c</code> are best described by the
      <span class="command"><strong><a href="gdbus-codegen.html">gdbus-codegen</a></strong></span> manual
      page, brief examples of how this generated code can be used can be found in
      <a class="xref" href="ch33s05.html#gdbus-example-codegen-server" title="Example 3. Server-side application using generated code">Example 3, “Server-side application using generated code”</a>
      and <a class="xref" href="ch33s05.html#gdbus-example-codegen-client" title="Example 4. Client-side application using generated code">Example 4, “Client-side application using generated code”</a>. Additionally, since
      the generated code has 100% gtk-doc coverage, see
      <a class="link" href="ExampleAnimal.html" title="ExampleAnimal"><span class="type">ExampleAnimal</span></a>, <a class="link" href="ExampleCat.html" title="ExampleCat"><span class="type">ExampleCat</span></a>, <a class="link" href="ExampleObject.html" title="ExampleObject"><span class="type">ExampleObject</span></a> and
      <a class="link" href="ExampleObjectManagerClient.html" title="ExampleObjectManagerClient"><span class="type">ExampleObjectManagerClient</span></a> pages for documentation.
    </p>
<div class="example">
<a name="gdbus-example-codegen-server"></a><p class="title"><b>Example 3. Server-side application using generated code</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;gdbus-object-manager-example/gdbus-example-objectmanager-generated.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="comment">/* ---------------------------------------------------------------------------------------------------- */</span>

<span class="gtkdoc kwb">static</span> GDBusObjectManagerServer <span class="gtkdoc opt">*</span>manager <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

<span class="gtkdoc kwb">static</span> gboolean
<span class="function">on_animal_poke</span> <span class="gtkdoc opt">(</span>ExampleAnimal          <span class="gtkdoc opt">*</span>animal<span class="gtkdoc opt">,</span>
                GDBusMethodInvocation  <span class="gtkdoc opt">*</span>invocation<span class="gtkdoc opt">,</span>
                gboolean                make_sad<span class="gtkdoc opt">,</span>
                gboolean                make_happy<span class="gtkdoc opt">,</span>
                gpointer                user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  <span class="keyword">if</span> <span class="gtkdoc opt">((</span>make_sad <span class="gtkdoc opt">&amp;&amp;</span> make_happy<span class="gtkdoc opt">) || (!</span>make_sad <span class="gtkdoc opt">&amp;&amp; !</span>make_happy<span class="gtkdoc opt">))</span>
    <span class="gtkdoc opt">{</span>
      <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> <span class="gtkdoc opt">(</span>invocation<span class="gtkdoc opt">,</span>
                                                  <span class="string">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.Failed&quot;</span><span class="gtkdoc opt">,</span>
                                                  <span class="string">&quot;Exactly one of make_sad or make_happy must be TRUE&quot;</span><span class="gtkdoc opt">);</span>
      <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
    <span class="gtkdoc opt">}</span>

  <span class="keyword">if</span> <span class="gtkdoc opt">(</span>make_sad<span class="gtkdoc opt">)</span>
    <span class="gtkdoc opt">{</span>
      <span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strcmp0">g_strcmp0</a></span> <span class="gtkdoc opt">(</span><span class="function"><a href="ExampleAnimal.html#example-animal-get-mood">example_animal_get_mood</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">),</span> <span class="string">&quot;Sad&quot;</span><span class="gtkdoc opt">) ==</span> <span class="number">0</span><span class="gtkdoc opt">)</span>
        <span class="gtkdoc opt">{</span>
          <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> <span class="gtkdoc opt">(</span>invocation<span class="gtkdoc opt">,</span>
                                                      <span class="string">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.SadAnimalIsSad&quot;</span><span class="gtkdoc opt">,</span>
                                                      <span class="string">&quot;Sad animal is already sad&quot;</span><span class="gtkdoc opt">);</span>
          <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
        <span class="gtkdoc opt">}</span>

      <span class="function"><a href="ExampleAnimal.html#example-animal-set-mood">example_animal_set_mood</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span> <span class="string">&quot;Sad&quot;</span><span class="gtkdoc opt">);</span>
      <span class="function"><a href="ExampleAnimal.html#example-animal-complete-poke">example_animal_complete_poke</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span> invocation<span class="gtkdoc opt">);</span>
      <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
    <span class="gtkdoc opt">}</span>

  <span class="keyword">if</span> <span class="gtkdoc opt">(</span>make_happy<span class="gtkdoc opt">)</span>
    <span class="gtkdoc opt">{</span>
      <span class="keyword">if</span> <span class="gtkdoc opt">(</span><span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strcmp0">g_strcmp0</a></span> <span class="gtkdoc opt">(</span><span class="function"><a href="ExampleAnimal.html#example-animal-get-mood">example_animal_get_mood</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">),</span> <span class="string">&quot;Happy&quot;</span><span class="gtkdoc opt">) ==</span> <span class="number">0</span><span class="gtkdoc opt">)</span>
        <span class="gtkdoc opt">{</span>
          <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> <span class="gtkdoc opt">(</span>invocation<span class="gtkdoc opt">,</span>
                                                      <span class="string">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.HappyAnimalIsHappy&quot;</span><span class="gtkdoc opt">,</span>
                                                      <span class="string">&quot;Happy animal is already happy&quot;</span><span class="gtkdoc opt">);</span>
          <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
        <span class="gtkdoc opt">}</span>

      <span class="function"><a href="ExampleAnimal.html#example-animal-set-mood">example_animal_set_mood</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span> <span class="string">&quot;Happy&quot;</span><span class="gtkdoc opt">);</span>
      <span class="function"><a href="ExampleAnimal.html#example-animal-complete-poke">example_animal_complete_poke</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span> invocation<span class="gtkdoc opt">);</span>
      <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
    <span class="gtkdoc opt">}</span>

  <span class="function"><a href="../glib/glib-Testing.html#g-assert-not-reached">g_assert_not_reached</a></span> <span class="gtkdoc opt">();</span>

 out<span class="gtkdoc opt">:</span>
  <span class="keyword">return</span> TRUE<span class="gtkdoc opt">;</span> <span class="comment">/* to indicate that the method was handled */</span>
<span class="gtkdoc opt">}</span>


<span class="gtkdoc kwb">static void</span>
<span class="function">on_bus_acquired</span> <span class="gtkdoc opt">(</span>GDBusConnection <span class="gtkdoc opt">*</span>connection<span class="gtkdoc opt">,</span>
                 <span class="gtkdoc kwb">const</span> gchar     <span class="gtkdoc opt">*</span>name<span class="gtkdoc opt">,</span>
                 gpointer         user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  ExampleObjectSkeleton <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">;</span>
  guint n<span class="gtkdoc opt">;</span>

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Acquired a message bus connection</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">);</span>

  <span class="comment">/* Create a new org.freedesktop.DBus.ObjectManager rooted at /example/Animals */</span>
  manager <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManagerServer.html#g-dbus-object-manager-server-new">g_dbus_object_manager_server_new</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;/example/Animals&quot;</span><span class="gtkdoc opt">);</span>

  <span class="keyword">for</span> <span class="gtkdoc opt">(</span>n <span class="gtkdoc opt">=</span> <span class="number">0</span><span class="gtkdoc opt">;</span> n <span class="gtkdoc opt">&lt;</span> <span class="number">10</span><span class="gtkdoc opt">;</span> n<span class="gtkdoc opt">++)</span>
    <span class="gtkdoc opt">{</span>
      gchar <span class="gtkdoc opt">*</span>s<span class="gtkdoc opt">;</span>
      ExampleAnimal <span class="gtkdoc opt">*</span>animal<span class="gtkdoc opt">;</span>

      <span class="comment">/* Create a new D-Bus object at the path /example/Animals/N where N is 000..009 */</span>
      s <span class="gtkdoc opt">=</span> <span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;/example/Animals/%03d&quot;</span><span class="gtkdoc opt">,</span> n<span class="gtkdoc opt">);</span>
      object <span class="gtkdoc opt">=</span> <span class="function"><a href="ExampleObject.html#example-object-skeleton-new">example_object_skeleton_new</a></span> <span class="gtkdoc opt">(</span>s<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>s<span class="gtkdoc opt">);</span>

      <span class="comment">/* Make the newly created object export the interface</span>
<span class="comment">       * org.gtk.GDBus.Example.ObjectManager.Animal (note</span>
<span class="comment">       * that &#64;object takes its own reference to &#64;animal).</span>
<span class="comment">       */</span>
      animal <span class="gtkdoc opt">=</span> <span class="function"><a href="ExampleAnimal.html#example-animal-skeleton-new">example_animal_skeleton_new</a></span> <span class="gtkdoc opt">();</span>
      <span class="function"><a href="ExampleAnimal.html#example-animal-set-mood">example_animal_set_mood</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span> <span class="string">&quot;Happy&quot;</span><span class="gtkdoc opt">);</span>
      <span class="function"><a href="ExampleObject.html#example-object-skeleton-set-animal">example_object_skeleton_set_animal</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">,</span> animal<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">);</span>

      <span class="comment">/* Cats are odd animals - so some of our objects implement the</span>
<span class="comment">       * org.gtk.GDBus.Example.ObjectManager.Cat interface in addition</span>
<span class="comment">       * to the .Animal interface</span>
<span class="comment">       */</span>
      <span class="keyword">if</span> <span class="gtkdoc opt">(</span>n <span class="gtkdoc opt">%</span> <span class="number">2</span> <span class="gtkdoc opt">==</span> <span class="number">1</span><span class="gtkdoc opt">)</span>
        <span class="gtkdoc opt">{</span>
          ExampleCat <span class="gtkdoc opt">*</span>cat<span class="gtkdoc opt">;</span>
          cat <span class="gtkdoc opt">=</span> <span class="function"><a href="ExampleCat.html#example-cat-skeleton-new">example_cat_skeleton_new</a></span> <span class="gtkdoc opt">();</span>
          <span class="function"><a href="ExampleObject.html#example-object-skeleton-set-cat">example_object_skeleton_set_cat</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">,</span> cat<span class="gtkdoc opt">);</span>
          <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>cat<span class="gtkdoc opt">);</span>
        <span class="gtkdoc opt">}</span>

      <span class="comment">/* Handle Poke() D-Bus method invocations on the .Animal interface */</span>
      <span class="function"><a href="../gobject/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>animal<span class="gtkdoc opt">,</span>
                        <span class="string">&quot;handle-poke&quot;</span><span class="gtkdoc opt">,</span>
                        <span class="function"><a href="../gobject/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>on_animal_poke<span class="gtkdoc opt">),</span>
                        NULL<span class="gtkdoc opt">);</span> <span class="comment">/* user_data */</span>

      <span class="comment">/* Export the object (&#64;manager takes its own reference to &#64;object) */</span>
      <span class="function"><a href="GDBusObjectManagerServer.html#g-dbus-object-manager-server-export">g_dbus_object_manager_server_export</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span> <span class="function">G_DBUS_OBJECT_SKELETON</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">));</span>
      <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
    <span class="gtkdoc opt">}</span>

  <span class="comment">/* Export all objects */</span>
  <span class="function"><a href="GDBusObjectManagerServer.html#g-dbus-object-manager-server-set-connection">g_dbus_object_manager_server_set_connection</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span> connection<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_name_acquired</span> <span class="gtkdoc opt">(</span>GDBusConnection <span class="gtkdoc opt">*</span>connection<span class="gtkdoc opt">,</span>
                  <span class="gtkdoc kwb">const</span> gchar     <span class="gtkdoc opt">*</span>name<span class="gtkdoc opt">,</span>
                  gpointer         user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Acquired the name %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> name<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_name_lost</span> <span class="gtkdoc opt">(</span>GDBusConnection <span class="gtkdoc opt">*</span>connection<span class="gtkdoc opt">,</span>
              <span class="gtkdoc kwb">const</span> gchar     <span class="gtkdoc opt">*</span>name<span class="gtkdoc opt">,</span>
              gpointer         user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Lost the name %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> name<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>


gint
<span class="function">main</span> <span class="gtkdoc opt">(</span>gint argc<span class="gtkdoc opt">,</span> gchar <span class="gtkdoc opt">*</span>argv<span class="gtkdoc opt">[])</span>
<span class="gtkdoc opt">{</span>
  GMainLoop <span class="gtkdoc opt">*</span>loop<span class="gtkdoc opt">;</span>
  guint id<span class="gtkdoc opt">;</span>

  loop <span class="gtkdoc opt">=</span> <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-new">g_main_loop_new</a></span> <span class="gtkdoc opt">(</span>NULL<span class="gtkdoc opt">,</span> FALSE<span class="gtkdoc opt">);</span>

  id <span class="gtkdoc opt">=</span> <span class="function"><a href="gio-Owning-Bus-Names.html#g-bus-own-name">g_bus_own_name</a></span> <span class="gtkdoc opt">(</span>G_BUS_TYPE_SESSION<span class="gtkdoc opt">,</span>
                       <span class="string">&quot;org.gtk.GDBus.Examples.ObjectManager&quot;</span><span class="gtkdoc opt">,</span>
                       G_BUS_NAME_OWNER_FLAGS_ALLOW_REPLACEMENT <span class="gtkdoc opt">|</span>
                       G_BUS_NAME_OWNER_FLAGS_REPLACE<span class="gtkdoc opt">,</span>
                       on_bus_acquired<span class="gtkdoc opt">,</span>
                       on_name_acquired<span class="gtkdoc opt">,</span>
                       on_name_lost<span class="gtkdoc opt">,</span>
                       loop<span class="gtkdoc opt">,</span>
                       NULL<span class="gtkdoc opt">);</span>

  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-run">g_main_loop_run</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>

  <span class="function"><a href="gio-Owning-Bus-Names.html#g-bus-unown-name">g_bus_unown_name</a></span> <span class="gtkdoc opt">(</span>id<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-unref">g_main_loop_unref</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>

  <span class="keyword">return</span> <span class="number">0</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break"><div class="example">
<a name="gdbus-example-codegen-client"></a><p class="title"><b>Example 4. Client-side application using generated code</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="gtkdoc ppc">#include</span> <span class="gtkdoc pps">&quot;gdbus-object-manager-example/gdbus-example-objectmanager-generated.h&quot;</span><span class="gtkdoc ppc"></span>

<span class="comment">/* ---------------------------------------------------------------------------------------------------- */</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">print_objects</span> <span class="gtkdoc opt">(</span>GDBusObjectManager <span class="gtkdoc opt">*</span>manager<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  GList <span class="gtkdoc opt">*</span>objects<span class="gtkdoc opt">;</span>
  GList <span class="gtkdoc opt">*</span>l<span class="gtkdoc opt">;</span>

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Object manager at %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusObjectManager.html#g-dbus-object-manager-get-object-path">g_dbus_object_manager_get_object_path</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">));</span>
  objects <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManager.html#g-dbus-object-manager-get-objects">g_dbus_object_manager_get_objects</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">);</span>
  <span class="keyword">for</span> <span class="gtkdoc opt">(</span>l <span class="gtkdoc opt">=</span> objects<span class="gtkdoc opt">;</span> l <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">;</span> l <span class="gtkdoc opt">=</span> l<span class="gtkdoc opt">-&gt;</span>next<span class="gtkdoc opt">)</span>
    <span class="gtkdoc opt">{</span>
      ExampleObject <span class="gtkdoc opt">*</span>object <span class="gtkdoc opt">=</span> <span class="function">EXAMPLE_OBJECT</span> <span class="gtkdoc opt">(</span>l<span class="gtkdoc opt">-&gt;</span>data<span class="gtkdoc opt">);</span>
      GList <span class="gtkdoc opt">*</span>interfaces<span class="gtkdoc opt">;</span>
      GList <span class="gtkdoc opt">*</span>ll<span class="gtkdoc opt">;</span>
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot; - Object at %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusObject.html#g-dbus-object-get-object-path">g_dbus_object_get_object_path</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">)));</span>

      interfaces <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObject.html#g-dbus-object-get-interfaces">g_dbus_object_get_interfaces</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">));</span>
      <span class="keyword">for</span> <span class="gtkdoc opt">(</span>ll <span class="gtkdoc opt">=</span> interfaces<span class="gtkdoc opt">;</span> ll <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">;</span> ll <span class="gtkdoc opt">=</span> ll<span class="gtkdoc opt">-&gt;</span>next<span class="gtkdoc opt">)</span>
        <span class="gtkdoc opt">{</span>
          GDBusInterface <span class="gtkdoc opt">*</span>interface <span class="gtkdoc opt">=</span> <span class="function">G_DBUS_INTERFACE</span> <span class="gtkdoc opt">(</span>ll<span class="gtkdoc opt">-&gt;</span>data<span class="gtkdoc opt">);</span>
          <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;   - Interface %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusInterface.html#g-dbus-interface-get-info">g_dbus_interface_get_info</a></span> <span class="gtkdoc opt">(</span>interface<span class="gtkdoc opt">)-&gt;</span>name<span class="gtkdoc opt">);</span>

          <span class="comment">/* Note that &#64;interface is really a GDBusProxy instance - and additionally also</span>
<span class="comment">           * an ExampleAnimal or ExampleCat instance - either of these can be used to</span>
<span class="comment">           * invoke methods on the remote object. For example, the generated function</span>
<span class="comment">           *</span>
<span class="comment">           *  void example_animal_call_poke_sync (ExampleAnimal  *proxy,</span>
<span class="comment">           *                                      gboolean        make_sad,</span>
<span class="comment">           *                                      gboolean        make_happy,</span>
<span class="comment">           *                                      GCancellable   *cancellable,</span>
<span class="comment">           *                                      GError        **error);</span>
<span class="comment">           *</span>
<span class="comment">           * can be used to call the Poke() D-Bus method on the .Animal interface.</span>
<span class="comment">           * Additionally, the generated function</span>
<span class="comment">           *</span>
<span class="comment">           *  const gchar *example_animal_get_mood (ExampleAnimal *object);</span>
<span class="comment">           *</span>
<span class="comment">           * can be used to get the value of the :Mood property.</span>
<span class="comment">           */</span>
        <span class="gtkdoc opt">}</span>
      <span class="function"><a href="../glib/glib-Doubly-Linked-Lists.html#g-list-free-full">g_list_free_full</a></span> <span class="gtkdoc opt">(</span>interfaces<span class="gtkdoc opt">,</span> g_object_unref<span class="gtkdoc opt">);</span>
    <span class="gtkdoc opt">}</span>
  <span class="function"><a href="../glib/glib-Doubly-Linked-Lists.html#g-list-free-full">g_list_free_full</a></span> <span class="gtkdoc opt">(</span>objects<span class="gtkdoc opt">,</span> g_object_unref<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_object_added</span> <span class="gtkdoc opt">(</span>GDBusObjectManager <span class="gtkdoc opt">*</span>manager<span class="gtkdoc opt">,</span>
                 GDBusObject        <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">,</span>
                 gpointer            user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  gchar <span class="gtkdoc opt">*</span>owner<span class="gtkdoc opt">;</span>
  owner <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManagerClient.html#g-dbus-object-manager-client-get-name-owner">g_dbus_object_manager_client_get_name_owner</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT_MANAGER_CLIENT</span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">));</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Added object at %s (owner %s)</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusObject.html#g-dbus-object-get-object-path">g_dbus_object_get_object_path</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">),</span> owner<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>owner<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_object_removed</span> <span class="gtkdoc opt">(</span>GDBusObjectManager <span class="gtkdoc opt">*</span>manager<span class="gtkdoc opt">,</span>
                   GDBusObject        <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">,</span>
                   gpointer            user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  gchar <span class="gtkdoc opt">*</span>owner<span class="gtkdoc opt">;</span>
  owner <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManagerClient.html#g-dbus-object-manager-client-get-name-owner">g_dbus_object_manager_client_get_name_owner</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT_MANAGER_CLIENT</span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">));</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Removed object at %s (owner %s)</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusObject.html#g-dbus-object-get-object-path">g_dbus_object_get_object_path</a></span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">),</span> owner<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>owner<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_notify_name_owner</span> <span class="gtkdoc opt">(</span>GObject    <span class="gtkdoc opt">*</span>object<span class="gtkdoc opt">,</span>
                      GParamSpec <span class="gtkdoc opt">*</span>pspec<span class="gtkdoc opt">,</span>
                      gpointer    user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  GDBusObjectManagerClient <span class="gtkdoc opt">*</span>manager <span class="gtkdoc opt">=</span> <span class="function">G_DBUS_OBJECT_MANAGER_CLIENT</span> <span class="gtkdoc opt">(</span>object<span class="gtkdoc opt">);</span>
  gchar <span class="gtkdoc opt">*</span>name_owner<span class="gtkdoc opt">;</span>

  name_owner <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManagerClient.html#g-dbus-object-manager-client-get-name-owner">g_dbus_object_manager_client_get_name_owner</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;name-owner: %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> name_owner<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>name_owner<span class="gtkdoc opt">);</span>
<span class="gtkdoc opt">}</span>

<span class="gtkdoc kwb">static void</span>
<span class="function">on_interface_proxy_properties_changed</span> <span class="gtkdoc opt">(</span>GDBusObjectManagerClient <span class="gtkdoc opt">*</span>manager<span class="gtkdoc opt">,</span>
                                       GDBusObjectProxy         <span class="gtkdoc opt">*</span>object_proxy<span class="gtkdoc opt">,</span>
                                       GDBusProxy               <span class="gtkdoc opt">*</span>interface_proxy<span class="gtkdoc opt">,</span>
                                       GVariant                 <span class="gtkdoc opt">*</span>changed_properties<span class="gtkdoc opt">,</span>
                                       <span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span><span class="gtkdoc kwb">const</span>       <span class="gtkdoc opt">*</span>invalidated_properties<span class="gtkdoc opt">,</span>
                                       gpointer                  user_data<span class="gtkdoc opt">)</span>
<span class="gtkdoc opt">{</span>
  GVariantIter iter<span class="gtkdoc opt">;</span>
  <span class="gtkdoc kwb">const</span> gchar <span class="gtkdoc opt">*</span>key<span class="gtkdoc opt">;</span>
  GVariant <span class="gtkdoc opt">*</span>value<span class="gtkdoc opt">;</span>
  gchar <span class="gtkdoc opt">*</span>s<span class="gtkdoc opt">;</span>

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Properties Changed on %s:</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> <span class="function"><a href="GDBusObject.html#g-dbus-object-get-object-path">g_dbus_object_get_object_path</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT</span> <span class="gtkdoc opt">(</span>object_proxy<span class="gtkdoc opt">)));</span>
  <span class="function"><a href="../glib/glib-GVariant.html#g-variant-iter-init">g_variant_iter_init</a></span> <span class="gtkdoc opt">(&amp;</span>iter<span class="gtkdoc opt">,</span> changed_properties<span class="gtkdoc opt">);</span>
  <span class="keyword">while</span> <span class="gtkdoc opt">(</span><span class="function"><a href="../glib/glib-GVariant.html#g-variant-iter-next">g_variant_iter_next</a></span> <span class="gtkdoc opt">(&amp;</span>iter<span class="gtkdoc opt">,</span> <span class="string">&quot;{&amp;sv}&quot;</span><span class="gtkdoc opt">, &amp;</span>key<span class="gtkdoc opt">, &amp;</span>value<span class="gtkdoc opt">))</span>
    <span class="gtkdoc opt">{</span>
      s <span class="gtkdoc opt">=</span> <span class="function"><a href="../glib/glib-GVariant.html#g-variant-print">g_variant_print</a></span> <span class="gtkdoc opt">(</span>value<span class="gtkdoc opt">,</span> TRUE<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;  %s -&gt; %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> key<span class="gtkdoc opt">,</span> s<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../glib/glib-GVariant.html#g-variant-unref">g_variant_unref</a></span> <span class="gtkdoc opt">(</span>value<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>s<span class="gtkdoc opt">);</span>
    <span class="gtkdoc opt">}</span>
<span class="gtkdoc opt">}</span>

gint
<span class="function">main</span> <span class="gtkdoc opt">(</span>gint argc<span class="gtkdoc opt">,</span> gchar <span class="gtkdoc opt">*</span>argv<span class="gtkdoc opt">[])</span>
<span class="gtkdoc opt">{</span>
  GDBusObjectManager <span class="gtkdoc opt">*</span>manager<span class="gtkdoc opt">;</span>
  GMainLoop <span class="gtkdoc opt">*</span>loop<span class="gtkdoc opt">;</span>
  GError <span class="gtkdoc opt">*</span>error<span class="gtkdoc opt">;</span>
  gchar <span class="gtkdoc opt">*</span>name_owner<span class="gtkdoc opt">;</span>

  manager <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
  loop <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>

  loop <span class="gtkdoc opt">=</span> <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-new">g_main_loop_new</a></span> <span class="gtkdoc opt">(</span>NULL<span class="gtkdoc opt">,</span> FALSE<span class="gtkdoc opt">);</span>

  error <span class="gtkdoc opt">=</span> NULL<span class="gtkdoc opt">;</span>
  manager <span class="gtkdoc opt">=</span> <span class="function"><a href="ExampleObjectManagerClient.html#example-object-manager-client-new-for-bus-sync">example_object_manager_client_new_for_bus_sync</a></span> <span class="gtkdoc opt">(</span>G_BUS_TYPE_SESSION<span class="gtkdoc opt">,</span>
                                                            G_DBUS_OBJECT_MANAGER_CLIENT_FLAGS_NONE<span class="gtkdoc opt">,</span>
                                                            <span class="string">&quot;org.gtk.GDBus.Examples.ObjectManager&quot;</span><span class="gtkdoc opt">,</span>
                                                            <span class="string">&quot;/example/Animals&quot;</span><span class="gtkdoc opt">,</span>
                                                            NULL<span class="gtkdoc opt">,</span> <span class="comment">/* GCancellable */</span>
                                                            <span class="gtkdoc opt">&amp;</span>error<span class="gtkdoc opt">);</span>
  <span class="keyword">if</span> <span class="gtkdoc opt">(</span>manager <span class="gtkdoc opt">==</span> NULL<span class="gtkdoc opt">)</span>
    <span class="gtkdoc opt">{</span>
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-printerr">g_printerr</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;Error getting object manager client: %s&quot;</span><span class="gtkdoc opt">,</span> error<span class="gtkdoc opt">-&gt;</span>message<span class="gtkdoc opt">);</span>
      <span class="function"><a href="../glib/glib-Error-Reporting.html#g-error-free">g_error_free</a></span> <span class="gtkdoc opt">(</span>error<span class="gtkdoc opt">);</span>
      <span class="keyword">goto</span> out<span class="gtkdoc opt">;</span>
    <span class="gtkdoc opt">}</span>

  name_owner <span class="gtkdoc opt">=</span> <span class="function"><a href="GDBusObjectManagerClient.html#g-dbus-object-manager-client-get-name-owner">g_dbus_object_manager_client_get_name_owner</a></span> <span class="gtkdoc opt">(</span><span class="function">G_DBUS_OBJECT_MANAGER_CLIENT</span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">));</span>
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> <span class="gtkdoc opt">(</span><span class="string">&quot;name-owner: %s</span><span class="gtkdoc esc">\n</span><span class="string">&quot;</span><span class="gtkdoc opt">,</span> name_owner<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> <span class="gtkdoc opt">(</span>name_owner<span class="gtkdoc opt">);</span>

  <span class="function">print_objects</span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">);</span>

  <span class="function"><a href="../gobject/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span>
                    <span class="string">&quot;notify::name-owner&quot;</span><span class="gtkdoc opt">,</span>
                    <span class="function"><a href="../gobject/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>on_notify_name_owner<span class="gtkdoc opt">),</span>
                    NULL<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../gobject/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span>
                    <span class="string">&quot;object-added&quot;</span><span class="gtkdoc opt">,</span>
                    <span class="function"><a href="../gobject/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>on_object_added<span class="gtkdoc opt">),</span>
                    NULL<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../gobject/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span>
                    <span class="string">&quot;object-removed&quot;</span><span class="gtkdoc opt">,</span>
                    <span class="function"><a href="../gobject/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>on_object_removed<span class="gtkdoc opt">),</span>
                    NULL<span class="gtkdoc opt">);</span>
  <span class="function"><a href="../gobject/gobject-Signals.html#g-signal-connect">g_signal_connect</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">,</span>
                    <span class="string">&quot;interface-proxy-properties-changed&quot;</span><span class="gtkdoc opt">,</span>
                    <span class="function"><a href="../gobject/gobject-Closures.html#G-CALLBACK:CAPS">G_CALLBACK</a></span> <span class="gtkdoc opt">(</span>on_interface_proxy_properties_changed<span class="gtkdoc opt">),</span>
                    NULL<span class="gtkdoc opt">);</span>

  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-run">g_main_loop_run</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>

 out<span class="gtkdoc opt">:</span>
  <span class="keyword">if</span> <span class="gtkdoc opt">(</span>manager <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">)</span>
    <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> <span class="gtkdoc opt">(</span>manager<span class="gtkdoc opt">);</span>
  <span class="keyword">if</span> <span class="gtkdoc opt">(</span>loop <span class="gtkdoc opt">!=</span> NULL<span class="gtkdoc opt">)</span>
    <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-unref">g_main_loop_unref</a></span> <span class="gtkdoc opt">(</span>loop<span class="gtkdoc opt">);</span>

  <span class="keyword">return</span> <span class="number">0</span><span class="gtkdoc opt">;</span>
<span class="gtkdoc opt">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break">
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.20.1</div>
</body>
</html>